<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 节点样式 */
        b{
            display: inline-block;
            width: 20px;
            background-color: aqua;
            border-radius: 50%;
            padding: 5px;
            position: relative;
            top: -5px;
        }
        div.tree {
            display: flex;
            flex-wrap: wrap;/*span 需要独占一行，所以此 flex 布局必须要折行显示 */
            align-items: flex-start; 
        }
        div.tree > span {
            width: 100%;
            text-align: center;
            padding-bottom: 3em;
            background-image: url(./img/both.svg);
            background-repeat: no-repeat;
            animation: opacity 1s linear;
        }
         /* 巧妙地子节点位置放置 */
         .tree > .tree {
            width: 50%;
        }
        /* 只有一个右节点使用 */
        div.just_only_right{
            flex-direction:row-reverse;  /*改变主轴的方向 */
        }
        div.just_only_right > span{
           background-image: url(./img/right.svg);
        }
        /* 只有一个左节点使用 */
        div.just_only_left > span {
            background-image: url(./img/left.svg);
        }
        div.no_child_node > span {
            background-image: none;
        }
        /* 左右子节点单独设置样式 */
        div.tree > .nleft {
            width: 50%;
            color: brown;
        }
        div.tree > .nright {
            width: 50%;
            color: aquamarine;
        }
        
        @keyframes opacity{
            0%{
                opacity: 0;
            }
            50%{
                opacity: 0.5;
            }
            100%{
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <h1 id = 'show'></h1>
    <button id ='refresh'>刷新</button>
    <button id ='addNode'>添加节点</button>
    <script>
        // 节点
        class Node{
            constructor(data,left,right){
                this.data = data;
                this.left = left;
                this.right =right;
                this.el = null;
            }
            bindTag(el){
                this.el = el;
            }
            show(){
                return this.data;
            }
        }
        //二叉树
        class BST{
            constructor(){
                this.root = null;
                this.rootArr = null;
            }
            insert(data){
                let n = new Node(data,null,null);
                if(this.root == null) {
                    this.root = n;
                    this.insertHtmlNode(document.body,this.root);
                }
                else{
                    let current = this.root;
                    let parent;
                    while(true){
                        parent = current;
                        if(data<current.data){
                            current = current.left;
                            if(current == null) {
                                parent.left = n;
                                let type = parent.right?'all':'left'
                                this.insertHtmlNode(parent.el,parent.left,type);
                                break
                            }
                        }else{
                            current = current.right;
                            if(current == null){
                                parent.right = n;
                                let type = parent.left?'all':'right'
                                this.insertHtmlNode(parent.el,parent.right,type);
                                break;
                            }
                        }
                    }
                }
            }
            //添加视图节点
            insertHtmlNode(el,node,type){
                let root = node;
                    if(root){
                        let template =  `<div class=" tree no_child_node"> <span> <b>${root.data}</b></span></div>`
                        let _treedoc = new DOMParser().parseFromString(template, 'text/html') 
                        let _tree = _treedoc.getElementsByClassName('tree')[0] 
                        node.bindTag( _tree); 
                        el.appendChild(_tree);
                        el.classList.remove('no_child_node','just_only_left','just_only_right')
                        type==='all'?'':el.classList.add(`just_only_${type}`)
                    }
            }
            //展示bst的arr结构
            show(el){
                this.inOrder(this.root)
                el.innerHTML = this.rootArr.toString();
                return this.rootArr;
            }
            inOrder(node){
                if(node != null){
                    this.inOrder(node.left);
                    this.rootArr?'':this.rootArr=[];
                    this.rootArr.push(node.show());
                    this.inOrder(node.right);
                }
            }
    }
        function refresh(){
            let _trees = document.getElementsByClassName('tree');
            console.log(_trees);
            [..._trees].forEach(element => {
                element.remove();
            });
            showTreeView()
        }
        function addNode(obj){
            let num = parseInt(Math.random()*100)
            obj.insert(num)
        }
        function createTree(){
            let BSTObj  =  new BST();
            new Array(30).fill('').forEach(element => {
                    let num = parseInt(Math.random()*100)
                    BSTObj.insert(num)
            });
            return BSTObj
        }
        function showTreeView(){
            let BSTObj = createTree()
            let _html = document.getElementById('show')
            BSTObj.show(_html);
            return BSTObj
        }
        function main(){
            let BSTObj = showTreeView()
            let _refreshBtn = document.getElementById('refresh')
            let _addNodeBtn = document.getElementById('addNode')
            _refreshBtn.addEventListener('click',refresh)
            _addNodeBtn.addEventListener('click',()=>addNode(BSTObj))
        }
        main();
    </script>
</body>
</html>